---
import '@grapesjs/studio-sdk/style';
import type { ProjectConfig } from '@grapesjs/studio-sdk';

const projectJSONFromServer: ProjectConfig = {
	id: 'StudioCMS_GrapesJSStudioSDK_Project',
	type: 'web',
	default: {
		pages: [
			{
				name: 'Home',
				id: 'xxxxxx1',
				component: `<h1 style="padding: 2rem; text-align: center">Hello Studio ðŸ‘‹</h1>`,
			},
		],
	},
};
---
<div id="app">
    <div class="cnt">
        <div class="cnt-nav">
            <div>Grapes StudioSDK</div>
        </div>
        <div class="cnt-body">
            <div 
              class="editor" 
              data-projectdata={JSON.stringify(projectJSONFromServer)}
              ></div>
        </div>
    </div>
</div>

<script>
    import createStudioEditor, { type ProjectConfig } from '@grapesjs/studio-sdk';

    function setupEditor(root: HTMLElement) {

        const projectJSONFromServer: ProjectConfig | undefined = root.dataset.projectdata ? JSON.parse(root.dataset.projectdata) : undefined;

        createStudioEditor({
            root,
            // TODO: Setup License key system so that we can get this value
            licenseKey: 'YOUR_LICENSE_KEY',
            project: projectJSONFromServer,
            // TODO: Setup ability to get user ID
            identity: {
              id: 'UNIQUE_END_USER_ID',
            },
            // TODO: Setup Assets config (Allow switching between cloud or StudioCMS)
            assets: {},
            // TODO: Setup Storage config (Allow switching between cloud or StudioCMS)
            storage: {
                type: 'self',
                // Provide a custom handler for saving the project data.
                onSave: async ({ project }) => console.log('Save project', { project }),
                autosaveChanges: 100,
                autosaveIntervalMs: 10000
            }
        });
    }
    
    setupEditor(document.querySelector<HTMLDivElement>('.editor')!);
</script>

<style>
  :root {
    font-family: Inter, system-ui, Avenir, Helvetica, Arial, sans-serif;
    line-height: 1.5;
    font-weight: 400;
  
    color-scheme: light dark;
    color: rgba(255, 255, 255, 0.87);
    background-color: #242424;
  
    font-synthesis: none;
    text-rendering: optimizeLegibility;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }
  
  .logo {
    height: 20px;
  }
  
  .cnt {
    display: flex;
    flex-direction: column;
    height: 100dvh;
  }
  
  .cnt-nav {
    padding: 10px;
    display: flex;
    gap: 5px;
  }
  
  .cnt-body {
    flex-grow: 1;
  }
  .editor {
    height: 100%;
  }
</style>