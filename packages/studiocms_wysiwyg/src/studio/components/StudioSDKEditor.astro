---
import '@grapesjs/studio-sdk/style';
import type { PluginPageTypeEditorProps } from 'studiocms/types';
import { importComponentsKeys } from 'studiocms/lib/renderer/runtime.js';
import { firstUpperCase, AstroSVG } from 'studiocms:wysiwyg/studio/client';

const _components = await importComponentsKeys();

const componentKeys = Object.keys(_components);

const AstroComponentBlocks = componentKeys.map((key) => {
	return {
		id: `astro-component-${key}`,
		label: firstUpperCase(key),
		category: 'Astro Components',
		media: AstroSVG,
		key,
	};
});

interface Props extends PluginPageTypeEditorProps {}

const { content } = Astro.props;
---
<div class="cnt-body">
  <div class="editor" 
    data-blocks={JSON.stringify(AstroComponentBlocks || [])}
    data-compkeys={JSON.stringify(componentKeys || [])}
    ></div>
  <textarea id="page-content" name="page-content" style="display: none;">{content}</textarea>
</div>

<script>
    import { licenseKey, getEditorSettings } from 'studiocms:wysiwyg/studio/client';
    import createStudioEditor from '@grapesjs/studio-sdk';

    const editor = document.querySelector<HTMLDivElement>('.editor') as HTMLDivElement;
    const pageContent = document.querySelector<HTMLTextAreaElement>('#page-content') as HTMLTextAreaElement;

    createStudioEditor(getEditorSettings(licenseKey, editor, pageContent));
</script>

<style>
  :root {
    font-family: Inter, system-ui, Avenir, Helvetica, Arial, sans-serif;
    line-height: 1.5;
    font-weight: 400;
  
    color-scheme: light dark;
    color: rgba(255, 255, 255, 0.87);
    background-color: #242424;
  
    font-synthesis: none;
    text-rendering: optimizeLegibility;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  .cnt-body {
    display: flex;
    flex-direction: column;
    height: 80dvh;
  }
  .editor {
    height: 100%;
  }
</style>